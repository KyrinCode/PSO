# ç²’å­ç¾¤ç®—æ³•

## ç®—æ³•èƒŒæ™¯

ç²’å­ç¾¤ä¼˜åŒ–ï¼ˆParticle Swarm Optimization, PSOï¼‰ï¼Œåˆç§°å¾®ç²’ç¾¤ç®—æ³•ï¼Œæ˜¯ç”±J. Kennedyå’ŒR. C. Eberhartç­‰äº1995å¹´å¼€å‘çš„ä¸€ç§æ¼”åŒ–è®¡ç®—æŠ€æœ¯ï¼Œæ¥æºäºå¯¹ä¸€ä¸ªç®€åŒ–ç¤¾ä¼šæ¨¡å‹çš„æ¨¡æ‹Ÿã€‚å…¶ä¸­â€œç¾¤ï¼ˆswarmï¼‰â€æ¥æºäºå¾®ç²’ç¾¤åŒ¹é…M. M. Millonasåœ¨å¼€å‘åº”ç”¨äºäººå·¥ç”Ÿå‘½ï¼ˆartificial lifeï¼‰çš„æ¨¡å‹æ—¶æ‰€æå‡ºçš„ç¾¤ä½“æ™ºèƒ½çš„5ä¸ªåŸºæœ¬åŸåˆ™ã€‚â€œç²’å­ï¼ˆparticleï¼‰â€æ˜¯ä¸€ä¸ªæŠ˜è¡·çš„é€‰æ‹©ï¼Œå› ä¸ºæ—¢éœ€è¦å°†ç¾¤ä½“ä¸­çš„æˆå‘˜æè¿°ä¸ºæ²¡æœ‰è´¨é‡ã€æ²¡æœ‰ä½“ç§¯çš„ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æè¿°å®ƒçš„é€Ÿåº¦å’ŒåŠ é€ŸçŠ¶æ€ã€‚

PSOç®—æ³•æœ€åˆæ˜¯ä¸ºäº†å›¾å½¢åŒ–çš„æ¨¡æ‹Ÿé¸Ÿç¾¤ä¼˜ç¾è€Œä¸å¯é¢„æµ‹çš„è¿åŠ¨ã€‚è€Œé€šè¿‡å¯¹åŠ¨ç‰©ç¤¾ä¼šè¡Œä¸ºçš„è§‚å¯Ÿï¼Œå‘ç°åœ¨ç¾¤ä½“ä¸­å¯¹ä¿¡æ¯çš„ç¤¾ä¼šå…±äº«æä¾›ä¸€ä¸ªæ¼”åŒ–çš„ä¼˜åŠ¿ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºå¼€å‘ç®—æ³•çš„åŸºç¡€ã€‚ä»éšæœºè§£å‡ºå‘ï¼Œé€šè¿‡è¿­ä»£å¯»æ‰¾æœ€ä¼˜è§£ï¼Œé€šè¿‡é€‚åº”åº¦æ¥è¯„ä»·è§£çš„å“è´¨ã€‚é€šè¿‡åŠ å…¥è¿‘é‚»çš„é€Ÿåº¦åŒ¹é…ã€å¹¶è€ƒè™‘äº†å¤šç»´æœç´¢å’Œæ ¹æ®è·ç¦»çš„åŠ é€Ÿï¼Œå½¢æˆäº†PSOçš„æœ€åˆç‰ˆæœ¬ã€‚ä¹‹åå¼•å…¥äº†æƒ¯æ€§æƒé‡æ¥æ›´å¥½çš„æ§åˆ¶å¼€å‘ï¼ˆexploitationï¼‰å’Œæ¢ç´¢ï¼ˆexplorationï¼‰ï¼Œå½¢æˆäº†æ ‡å‡†ç‰ˆæœ¬ã€‚ä¸ºäº†æé«˜ç²’ç¾¤ç®—æ³•çš„æ€§èƒ½å’Œå®ç”¨æ€§ï¼Œä¸­å±±å¤§å­¦ã€ï¼ˆè‹±å›½ï¼‰æ ¼æ‹‰æ–¯å“¥å¤§å­¦ç­‰åˆå¼€å‘äº†è‡ªé€‚åº”ï¼ˆAdaptive PSOï¼‰ç‰ˆæœ¬å’Œç¦»æ•£ï¼ˆdiscreteï¼‰ç‰ˆæœ¬ã€‚

## ç®—æ³•æ€æƒ³

è®¾æƒ³è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šä¸€ç¾¤é¸Ÿåœ¨éšæœºæœç´¢é£Ÿç‰©ã€‚åœ¨è¿™ä¸ªåŒºåŸŸé‡Œåªæœ‰ä¸€å—é£Ÿç‰©ã€‚æ‰€æœ‰çš„é¸Ÿéƒ½ä¸çŸ¥é“é£Ÿç‰©åœ¨é‚£é‡Œã€‚ä½†æ˜¯ä»–ä»¬çŸ¥é“å½“å‰çš„ä½ç½®ç¦»é£Ÿç‰©è¿˜æœ‰å¤šè¿œï¼ˆé€šè¿‡é£Ÿç‰©çš„æ°”å‘³ï¼‰ã€‚é‚£ä¹ˆæ‰¾åˆ°é£Ÿç‰©çš„æœ€ä¼˜ç­–ç•¥æ˜¯ä»€ä¹ˆå‘¢ã€‚æœ€ç®€å•æœ‰æ•ˆçš„å°±æ˜¯æœå¯»ç›®å‰ç¦»é£Ÿç‰©æœ€è¿‘çš„é¸Ÿçš„å‘¨å›´åŒºåŸŸã€‚æˆ‘ä»¬å‡è®¾ç¾¤ä½“ä¸­æ¯åªé¸Ÿçš„é£è¡Œè¡Œä¸ºå‡ä¸”ä»…å—åˆ°ä¸‰æ–¹é¢å› ç´ çš„å½±å“å’Œè´¡çŒ®ï¼š

* æ¯åªé¸Ÿè‡ªèº«çš„é£è¡Œæƒ¯æ€§ --- è‡ªèº«æƒ¯æ€§è´¡çŒ®ï¼›

* æ¯åªé¸Ÿçš„å†å²æœ€ä¼˜çŠ¶æ€ --- è‡ªèº«è®¤çŸ¥è´¡çŒ®ï¼›

* æ•´ä¸ªé¸Ÿç¾¤çš„å†å²æœ€ä¼˜çŠ¶æ€ --- ç¾¤ä½“ç»éªŒè´¡çŒ®ã€‚

æ³¨æ„ï¼Œæ­¤å¤„ä»¥ä¸é£Ÿç‰©çš„è·ç¦»ï¼ˆå³é¦™å‘³æµ“åº¦ï¼Œä¹Ÿå°±æ˜¯çŠ¶æ€å‡½æ•°å€¼ï¼‰æ¥åˆ¤æ–­é£è¡ŒçŠ¶æ€çš„ä¼˜åŠ£ã€‚æ ¹æ®æ­¤ä¸‰ç±»è´¡çŒ®ï¼ŒçŠ¶æ€ç©ºé—´å†…æ¯åªé¸Ÿå°†é€æ¸è°ƒæ•´è‡ªèº«çš„é£è¡Œé€Ÿåº¦ï¼ˆåŒ…æ‹¬å¤§å°ã€æ–¹å‘ï¼‰ï¼Œå¹¶å‘é£Ÿç‰©ä½ç½®ï¼ˆå³å±€éƒ¨é¦™å‘³æœ€æµ“çš„ä½ç½®ï¼‰æ±‡èšã€‚å› æ­¤ï¼Œåœ¨ç›¸å…³å‚æ•°è®¾ç½®åˆç†çš„å‰æä¸‹ï¼Œç²’å­ç¾¤ç®—æ³•çš„æœ€ç»ˆè§£åº”è¯¥å¯¹åº”äºç»™å®šçŠ¶æ€ç©ºé—´å†…çš„æœ€å€¼ã€‚

## ç®—æ³•æµç¨‹

æ ‡å‡†PSOç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š

1. åˆå§‹åŒ–ä¸€ç¾¤å¾®ç²’ï¼ˆç¾¤ä½“è§„æ¨¡ä¸º$m$ï¼‰ï¼ŒåŒ…æ‹¬éšæœºçš„ä½ç½®$x$å’Œé€Ÿåº¦$v$ï¼›
2. è¯„ä»·æ¯ä¸ªå¾®ç²’çš„é€‚åº”åº¦$fitness$ï¼›
3. å¯¹æ¯ä¸ªå¾®ç²’ï¼Œå°†å®ƒçš„é€‚åº”å€¼å’Œå®ƒç»å†è¿‡çš„æœ€å¥½ä½ç½®$pbest$çš„ä½œæ¯”è¾ƒï¼Œå¦‚æœè¾ƒå¥½ï¼Œåˆ™å°†å…¶ä½œä¸ºå½“å‰çš„æœ€å¥½ä½ç½®$pbest$ï¼›
4. å¯¹æ¯ä¸ªå¾®ç²’ï¼Œå°†å®ƒçš„é€‚åº”åº¦$fitness$å’Œå…¨å±€æ‰€ç»å†æœ€å¥½ä½ç½®$gbest$çš„ä½œæ¯”è¾ƒï¼Œå¦‚æœè¾ƒå¥½ï¼Œåˆ™é‡æ–°è®¾ç½®$gbest$çš„ç´¢å¼•å·ï¼›
5. æ›´æ–°å¾®ç²’çš„ä½ç½®$x$å’Œé€Ÿåº¦$v$ï¼›
6. å¦‚æœªè¾¾åˆ°ç»“æŸæ¡ä»¶ï¼ˆé€šå¸¸ä¸ºè¶³å¤Ÿå¥½çš„é€‚åº”å€¼æˆ–è¾¾åˆ°ä¸€ä¸ªé¢„è®¾æœ€å¤§ä»£æ•°$iterMax$ï¼‰ï¼Œå›åˆ°2ï¼‰ã€‚

##  è¿­ä»£å…¬å¼

**ç²’å­ç¾¤é€Ÿåº¦æ›´æ–°å…¬å¼**ï¼š

$V_ğ‘–(ğ‘¡+1)=ğœ”V_ğ‘–(ğ‘¡)+ğ‘_1ğ‘Ÿ_1(ğ‘ğ‘ğ‘’ğ‘ ğ‘¡_ğ‘–âˆ’X_ğ‘–(ğ‘¡))+ğ‘_2ğ‘Ÿ_2(ğ‘”ğ‘ğ‘’ğ‘ ğ‘¡âˆ’X_ğ‘–(ğ‘¡))$
å¼ä¸­å³é¢ä¸‰é¡¹åˆ†åˆ«ä»£è¡¨ï¼šè‡ªèº«æƒ¯æ€§è´¡çŒ®ã€è‡ªèº«è®¤çŸ¥è´¡çŒ®å’Œç¾¤ä½“ç»éªŒè´¡çŒ®ã€‚

$w$ï¼šæƒ¯æ€§å› å­

$c_1$ã€$c_2$ï¼šå­¦ä¹ å› å­

$r_1$ã€$r_2$ï¼š[0,1]ä¹‹é—´çš„å‡åŒ€éšæœºæ•°

$pbest_i$ï¼šç¬¬$i$ä¸ªç²’å­ç›®å‰çš„å†å²æœ€ä¼˜çŠ¶æ€

$gbest$ï¼šæ•´ä¸ªç²’å­ç¾¤ç›®å‰çš„å†å²æœ€ä¼˜çŠ¶æ€

$V_i(t)$ï¼š$t$æ—¶åˆ»ç²’å­$i$çš„é€Ÿåº¦

$X_i(t)$ï¼š$t$æ—¶åˆ»ç²’å­$i$çš„ä½ç½®

å®é™…é—®é¢˜å¯èƒ½å¤„äºå¤šç»´ç©ºé—´å†…ï¼Œå› æ­¤æœ‰ï¼š

$V_i=(v_{i1},v_{i2},...,v_{iD})$ 

$X_i=(x_{i1},x_{i2},...,x_{iD})$

$D$ï¼šç©ºé—´ç»´æ•°

**ç²’å­ç¾¤ä½ç½®æ›´æ–°å…¬å¼**ï¼š

$X_i(t+1)=X_i(t)+V_i(t+1)$

## ä»£ç å®ç°

```python
import numpy as np
import matplotlib.pyplot as plt
import random

class Particle(object):
    def __init__(self, v, x):
        self.v = v                    # ç²’å­å½“å‰é€Ÿåº¦
        self.x = x                    # ç²’å­å½“å‰ä½ç½®
        self.pbest = x                # ç²’å­å†å²æœ€ä¼˜ä½ç½®
        
class PSO(object):
    def __init__(self, interval, tab='min', Num=10, iterMax=1000, w=1, c1=1, c2=1):
        self.interval = interval                              # ç»™å®šæ±‚è§£ç©ºé—´
        self.tab = tab.strip()                                # æ±‚è§£æœ€å¤§å€¼è¿˜æ˜¯æœ€å°å€¼çš„æ ‡ç­¾: 'min' - æœ€å°å€¼ï¼›'max' - æœ€å¤§å€¼
        self.iterMax = iterMax                                # è¿­ä»£æ±‚è§£æ¬¡æ•°
        self.w = w                                            # æƒ¯æ€§å› å­
        self.c1, self.c2 = c1, c2                             # å­¦ä¹ å› å­
        self.v_max = (interval[1] - interval[0]) * 0.1        # è®¾ç½®æœ€å¤§é€Ÿåº¦
        #######################################################
        self.particle_list, self.gbest = self.initPartis(Num) # å®Œæˆç²’å­ç¾¤çš„åˆå§‹åŒ–ï¼Œå¹¶æå–ç¾¤ä½“å†å²æœ€ä¼˜ä½ç½®
        self.x_seeds = np.array(list(particle.x for particle in self.particle_list))     # æå–ç²’å­ç¾¤çš„ç§å­çŠ¶æ€
        self.solve()                                          # å®Œæˆä¸»ä½“æ±‚è§£è¿‡ç¨‹
        self.display()                                        # æ•°æ®å¯è§†åŒ–å±•ç¤º
        
    def initPartis(self, Num):
        particle_list = list()
        for i in range(Num):
            v_seed = random.uniform(-self.v_max, self.v_max)
            x_seed = random.uniform(*self.interval)
            particle_list.append(Particle(v_seed, x_seed))
        temp = 'find_' + self.tab
        if hasattr(self, temp):                               # é‡‡ç”¨åå°„æ–¹æ³•æå–å¯¹åº”çš„å‡½æ•°
            gbest = getattr(self, temp)(particle_list)
        else:
            exit('>>>tabæ ‡ç­¾ä¼ å‚æœ‰è¯¯ï¼š"min"|"max"<<<')
        return particle_list, gbest
        
    def solve(self):
        for i in range(self.iterMax):
            for particle in self.particle_list:
                f1 = self.func(particle.x)
                # æ›´æ–°ç²’å­é€Ÿåº¦ï¼Œå¹¶é™åˆ¶åœ¨æœ€å¤§é€Ÿåº¦ä¹‹å†…
                particle.v = self.w * particle.v + self.c1 * random.random() * (particle.pbest - particle.x) + self.c2 * random.random() * (self.gbest - particle.x)
                if particle.v > self.v_max:
                    particle.v = self.v_max
                elif particle.v < -self.v_max:
                    particle.v = -self.v_max
                # æ›´æ–°ç²’å­ä½ç½®ï¼Œå¹¶é™åˆ¶åœ¨å¾…è§£åŒºé—´ä¹‹å†…
                if self.interval[0] <= particle.x + particle.v <=self.interval[1]:
                    particle.x = particle.x + particle.v 
                else:
                    particle.x = particle.x - particle.v          # ä¸è®©ç²’å­è¶…å‡ºé™åˆ¶ç©ºé—´ä¹‹å¤–æœ‰å¾ˆå¤šæ–¹æ³•
                f2 = self.func(particle.x)
                getattr(self, 'deal_'+self.tab)(f1, f2, particle) # æ›´æ–°ç²’å­å†å²æœ€ä¼˜ä½ç½®ä¸ç¾¤ä½“å†å²æœ€ä¼˜ä½ç½®      
        
    def func(self, x):                                            # é€‚åº”åº¦å‡½æ•°
        value = np.sin(x**2) * (x**2 - 2*x)
        return value
        
    def find_min(self, particle_list):              # æŒ‰é€‚åº”åº¦å‡½æ•°æœ€å°å€¼æ‰¾åˆ°ç²’å­ç¾¤åˆå§‹åŒ–çš„å†å²æœ€ä¼˜ä½ç½®
        p = min(particle_list, key=lambda p: self.func(p.pbest))
        return p.pbest
        
    def find_max(self, particle_list):              # æŒ‰é€‚åº”åº¦å‡½æ•°æœ€å¤§å€¼æ‰¾åˆ°ç²’å­ç¾¤åˆå§‹åŒ–çš„å†å²æœ€ä¼˜ä½ç½®
        p = max(particle_list, key=lambda p: self.func(p.pbest))
        return p.pbest
        
    def deal_min(self, f1, f2, particle):
        if f2 < f1:                                 # æ›´æ–°ç²’å­å†å²æœ€ä¼˜ä½ç½®
            particle.pbest = particle.x
        if f2 < self.func(self.gbest):
            self.gbest = particle.x                 # æ›´æ–°ç¾¤ä½“å†å²æœ€ä¼˜ä½ç½®
            
    def deal_max(self, f1, f2, particle):
        if f2 > f1:                                 # æ›´æ–°ç²’å­å†å²æœ€ä¼˜ä½ç½®
            particle.pbest = particle.x
        if f2 > self.func(self.gbest):
            self.gbest = particle.x                 # æ›´æ–°ç¾¤ä½“å†å²æœ€ä¼˜ä½ç½®
            
    def display(self):
        print('solution: {}'.format(self.gbest))
        plt.figure(figsize=(8, 4))
        x = np.linspace(self.interval[0], self.interval[1], 300)
        y = self.func(x)
        plt.plot(x, y, 'g-', label='function')
        plt.plot(self.x_seeds, self.func(self.x_seeds), 'b.', label='seeds')
        plt.plot(self.gbest, self.func(self.gbest), 'r*', label='solution')
        plt.xlabel('x')
        plt.ylabel('f(x)')
        plt.title('solution = {}'.format(self.gbest))
        plt.legend()
        plt.savefig('PSO.png', dpi=500)
        plt.show()
        plt.close()

if __name__ == '__main__':
    PSO([-10, 10], 'max')
```

## ä»£ç åˆ†æ

è¿è¡Œç¯å¢ƒï¼šPython3

é€‚åº”åº¦å‡½æ•°ä¸¾ä¾‹ï¼š$f(x)=sin(x^2)Ã—(x^2 - 2x)$

æœ€ä¼˜åŒ–ç›®æ ‡ï¼šæ‰¾åˆ°åœ¨é€‚åº”åº¦å‡½æ•°$f(x)$åœ¨æ±‚è§£èŒƒå›´$[low\_bound, up\_bound]$å†…æœ€å¤§ï¼ˆmaxï¼‰æˆ–æœ€å°ï¼ˆminï¼‰æ—¶$x$çš„å€¼

ä»¥è¿è¡Œ

```python
PSO([-10, 10], 'max')
```

ä¸ºä¾‹

å¾—åˆ°ç»“æœï¼š$x=-9.789184124916444$

![PSO](./PSO.png)

è“è‰²ç‚¹ä¸ºåˆå§‹åŒ–æ—¶çš„ç²’å­ä½ç½®ï¼Œçº¢è‰²ç‚¹ä¸ºç»è¿‡ç²’å­ç¾¤ç®—æ³•è¿­ä»£æ±‚è§£åå¾—åˆ°çš„æœ€ä¼˜å€¼ã€‚